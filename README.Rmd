---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->
<!-- use devtools::build_readme() -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE,
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# omopcepts

<!-- badges: start -->
<!-- badges: end -->

omopcepts provides access to a subset of **OMOP** con**cepts** and flexible tidyverse compatible R functions for querying.    

The [OMOP Common Data Model](https://ohdsi.github.io/CommonDataModel/) is an open standard for health data. "[It is] designed to standardize the structure and content of observational data and to enable efficient analyses that can produce reliable evidence".    
    
OMOP is maintained by OHDSI (pronounced "Odyssey"). "The Observational Health Data Sciences and Informatics  program is a multi-stakeholder, interdisciplinary collaborative that strives to improve medical decision making and bring better health outcomes to patients around the world."    
    
OMOP concepts can be searched and downloaded from [Athena â€“ the  OHDSI vocabularies repository](https://athena.ohdsi.org).    
    
This package provides R tools to interact with the concepts in a more reproducible way.

## Installation

Install the development version of omopcepts with:

``` r
# install.packages("remotes")

remotes::install_github("andysouth/omopcepts")

```

## Concept data

OMOP vocab data downloaded from Athena includes a table called CONCEPT.csv, that is used in this package.

```{r concept table, echo=FALSE}

library(omopcepts)
data(concept)

df1 <- data.frame(fields=names(concept),
                  about=c("unique id","descriptive name","e.g. drug, measurement","e.g. LOINC, SNOMED","e.g. Clinical Observation, Organism","standard or not","source code"),
                  query_arguments=c("c_ids","pattern","d_ids","v_ids","cc_ids","standard","")
                  )

knitr::kable(df1)
```

## String search in concept_name field

```{r omop_names, echo=TRUE}

omop_names("chemotherapy", v_ids="LOINC")

omop_names("chemotherapy", v_ids=c("LOINC","SNOMED"), d_ids=c("Observation","Procedure"))

```

## Join OMOP names onto a dataframe containing concept ids in a column called *concept_id

Helps to interpret OMOP data.

```{r join_omop_name, echo=TRUE}


data.frame(concept_id=(c(3571338L,4002075L))) |> 
  join_omop_name()
 

data.frame(drug_concept_id=(c(4000794L,4002592L))) |> 
  join_omop_name(namestart="drug")


```


## Vocabularies included

Initially just a few vocabularies are included to keep the size of the data file down. Later we may offer option to add other vocabularies.

```{r example}

library(dplyr)

## showing what vocabs are included
concept |> count(vocabulary_id)

```

### Numbers of concepts in the package by domain and vocabulary

```{r conceptplot, echo = TRUE}
library(ggplot2)
library(forcats)

ggplot(concept, aes(y=fct_rev(fct_infreq(domain_id)), 
                    fill=vocabulary_id)) +
  geom_bar() +
  labs(y = "domain_id") +
  theme_minimal()
```

